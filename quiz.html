<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ワインクイズ - MyWineMemory</title>
    
    <!-- PWA設定 -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WineMemory">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    
    <!-- 高度なスタイル -->
    <link rel="stylesheet" href="/advanced-style.css">
</head>
<body>
    <!-- Professional Navigation Header -->
    <nav class="main-navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <span class="brand-icon">🍷</span>
                <span class="brand-text">MyWineMemory</span>
            </div>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="メニューを開く">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <div class="navbar-menu" id="navbarMenu">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a href="/" class="nav-link">
                            <span class="nav-icon">🏠</span>
                            <span class="nav-text">ホーム</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/quiz.html" class="nav-link active">
                            <span class="nav-icon">🧠</span>
                            <span class="nav-text">クイズ</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/analytics.html" class="nav-link">
                            <span class="nav-icon">📊</span>
                            <span class="nav-text">分析</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/ai-evaluation.html" class="nav-link">
                            <span class="nav-icon">🤖</span>
                            <span class="nav-text">AI分析</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/learning-progress.html" class="nav-link">
                            <span class="nav-icon">📈</span>
                            <span class="nav-text">学習進捗</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/skill-tree.html" class="nav-link">
                            <span class="nav-icon">🌳</span>
                            <span class="nav-text">スキルツリー</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <button id="theme-toggle" class="theme-toggle nav-link nav-button" aria-label="テーマ切り替え">
                            <span class="theme-icon">🌙</span>
                            <span class="nav-text">テーマ</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <div class="quiz-page">
            <div class="quiz-header">
                <h1>🧠 ワイン知識クイズ</h1>
                <p>あなたのワイン知識をテストし、スキルを向上させましょう</p>
            </div>
            
            <!-- クイズ選択 -->
            <div class="quiz-types" id="quizTypes">
                <div class="quiz-type-card" onclick="startQuiz('basic')">
                    <div class="quiz-icon">🍇</div>
                    <h3>基本クイズ</h3>
                    <p>ワインの基礎知識をテスト</p>
                    <div class="card-action">開始する</div>
                </div>
                <div class="quiz-type-card" onclick="startQuiz('advanced')">
                    <div class="quiz-icon">🏆</div>
                    <h3>上級クイズ</h3>
                    <p>上級者向けの難しい問題</p>
                    <div class="card-action">挑戦する</div>
                </div>
                <div class="quiz-type-card" onclick="startQuiz('regions')">
                    <div class="quiz-icon">🌍</div>
                    <h3>産地クイズ</h3>
                    <p>世界のワイン産地について</p>
                    <div class="card-action">学習する</div>
                </div>
                <div class="quiz-type-card" onclick="startQuiz('tasting')">
                    <div class="quiz-icon">👅</div>
                    <h3>テイスティング</h3>
                    <p>味わいや香りの特徴</p>
                    <div class="card-action">試す</div>
                </div>
            </div>
            
            <!-- クイズゲーム -->
            <div id="quizGame" class="quiz-game hidden">
                <div class="quiz-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="progress-text" id="progressText">1/10</span>
                </div>
                
                <div class="quiz-content">
                    <div class="quiz-question">
                        <h2 id="questionText"></h2>
                    </div>
                    
                    <div id="questionOptions" class="quiz-options"></div>
                    
                    <div class="quiz-controls">
                        <button id="nextButton" class="btn primary-btn" onclick="nextQuestion()" disabled>次へ</button>
                        <button class="btn outline-btn" onclick="endQuiz()">終了</button>
                    </div>
                </div>
            </div>
            
            <!-- クイズ結果 -->
            <div id="quizResults" class="quiz-results hidden">
                <div class="results-content">
                    <h2>🎉 クイズ結果</h2>
                    <div class="result-score">
                        <span class="score-number" id="finalScore">0</span>
                        <span class="score-total">/10</span>
                        <span class="score-label">正解</span>
                    </div>
                    <div class="result-message" id="resultMessage"></div>
                    <div class="result-actions">
                        <button class="btn primary-btn" onclick="restartQuiz()">もう一度</button>
                        <button class="btn secondary-btn" onclick="backToTypes()">別のクイズ</button>
                        <button class="btn outline-btn" onclick="goHome()">ホームへ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // クイズデータ
        const quizData = {
            basic: [
                {
                    question: "フランスの代表的なワイン産地はどれですか？",
                    options: ["ボルドー", "トスカーナ", "ナパバレー", "モーゼル"],
                    correct: 0
                },
                {
                    question: "赤ワインの主な色素成分は何ですか？",
                    options: ["タンニン", "アントシアニン", "レスベラトロール", "アルコール"],
                    correct: 1
                },
                {
                    question: "シャンパーニュの製法として正しいのはどれですか？",
                    options: ["シャルマ方式", "メトード・シャンプノワーズ", "炭酸注入", "自然発酵"],
                    correct: 1
                },
                {
                    question: "ワインの「テロワール」とは何を意味しますか？",
                    options: ["ブドウの品種", "土壌・気候・風土", "醸造技術", "熟成期間"],
                    correct: 1
                },
                {
                    question: "「ヴィンテージ」とは何を表しますか？",
                    options: ["ブドウの収穫年", "ワインの価格", "アルコール度数", "熟成期間"],
                    correct: 0
                }
            ],
            advanced: [
                {
                    question: "ボルドーの左岸で主に栽培されるブドウ品種は？",
                    options: ["メルロー", "カベルネ・ソーヴィニヨン", "ピノ・ノワール", "シラー"],
                    correct: 1
                },
                {
                    question: "マロラクティック発酵の目的は？",
                    options: ["糖分をアルコールに変換", "酸味を和らげる", "色素を抽出", "タンニンを除去"],
                    correct: 1
                },
                {
                    question: "「グラン・クリュ」の意味は？",
                    options: ["大きな醸造所", "特級畑", "長期熟成", "高価格帯"],
                    correct: 1
                },
                {
                    question: "シャンパーニュの「デゴルジュマン」とは？",
                    options: ["ボトル詰め", "澱の除去", "糖分添加", "ラベル貼り"],
                    correct: 1
                },
                {
                    question: "バロロワインの主要ブドウ品種は？",
                    options: ["サンジョヴェーゼ", "ネッビオーロ", "バルベラ", "ドルチェット"],
                    correct: 1
                }
            ],
            regions: [
                {
                    question: "ブルゴーニュの代表的な白ブドウ品種は？",
                    options: ["シャルドネ", "ソーヴィニヨン・ブラン", "リースリング", "ゲヴュルツトラミナー"],
                    correct: 0
                },
                {
                    question: "キャンティはどの国のワインですか？",
                    options: ["フランス", "イタリア", "スペイン", "ドイツ"],
                    correct: 1
                },
                {
                    question: "リオハワインの主要産地国は？",
                    options: ["ポルトガル", "スペイン", "アルゼンチン", "チリ"],
                    correct: 1
                },
                {
                    question: "ナパバレーがあるのはどの国？",
                    options: ["カナダ", "オーストラリア", "アメリカ", "南アフリカ"],
                    correct: 2
                },
                {
                    question: "モーゼル地域で有名なブドウ品種は？",
                    options: ["シャルドネ", "リースリング", "ピノ・グリ", "ゲヴュルツトラミナー"],
                    correct: 1
                }
            ],
            tasting: [
                {
                    question: "ワインの「ボディ」とは何を表しますか？",
                    options: ["色の濃さ", "香りの強さ", "味わいの厚み", "アルコール度数"],
                    correct: 2
                },
                {
                    question: "タンニンが多いワインの特徴は？",
                    options: ["甘い", "渋い", "酸っぱい", "塩辛い"],
                    correct: 1
                },
                {
                    question: "ワインテイスティングの正しい順序は？",
                    options: ["香り→外観→味わい", "外観→香り→味わい", "味わい→香り→外観", "香り→味わい→外観"],
                    correct: 1
                },
                {
                    question: "ワインの「フィニッシュ」とは？",
                    options: ["最初の香り", "口の中での余韻", "ワインの色", "アルコール感"],
                    correct: 1
                },
                {
                    question: "「レッグ」や「ティアーズ」と呼ばれるのは？",
                    options: ["ワインの色", "グラスを回した時の雫", "香りの強さ", "泡の細かさ"],
                    correct: 1
                }
            ]
        };

        // グローバル変数
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswers = [];

        // クイズ開始
        function startQuiz(type) {
            currentQuiz = quizData[type];
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswers = [];
            
            document.getElementById('quizTypes').style.display = 'none';
            document.getElementById('quizGame').classList.remove('hidden');
            document.getElementById('quizResults').classList.add('hidden');
            
            showQuestion();
        }

        // 問題表示
        function showQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('questionOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'quiz-option btn';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            updateProgress();
            document.getElementById('nextButton').disabled = true;
        }

        // 回答選択
        function selectAnswer(selectedIndex) {
            const question = currentQuiz[currentQuestionIndex];
            const options = document.querySelectorAll('.quiz-option');
            
            // 選択状態をリセット
            options.forEach(option => {
                option.classList.remove('selected', 'correct', 'incorrect');
                option.disabled = false;
            });
            
            // 選択したオプションをハイライト
            options[selectedIndex].classList.add('selected');
            
            // 答えを記録
            selectedAnswers[currentQuestionIndex] = selectedIndex;
            
            // 正解判定（即座に表示）
            setTimeout(() => {
                options.forEach((option, index) => {
                    option.disabled = true;
                    if (index === question.correct) {
                        option.classList.add('correct');
                    } else if (index === selectedIndex && selectedIndex !== question.correct) {
                        option.classList.add('incorrect');
                    }
                });
                
                if (selectedIndex === question.correct) {
                    score++;
                }
                
                document.getElementById('nextButton').disabled = false;
            }, 500);
        }

        // 次の問題
        function nextQuestion() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= currentQuiz.length) {
                showQuizResults();
            } else {
                showQuestion();
            }
        }

        // 結果表示
        function showQuizResults() {
            document.getElementById('quizGame').classList.add('hidden');
            document.getElementById('quizResults').classList.remove('hidden');
            
            document.getElementById('finalScore').textContent = score;
            
            let message = '';
            const percentage = (score / currentQuiz.length) * 100;
            if (percentage >= 90) {
                message = '🌟 完璧！ワインエキスパートですね！';
            } else if (percentage >= 80) {
                message = '🎉 素晴らしい！とても詳しいですね！';
            } else if (percentage >= 60) {
                message = '👏 よくできました！もう少しで完璧です。';
            } else if (percentage >= 40) {
                message = '📚 なかなか！さらに学習を続けましょう。';
            } else {
                message = '🌱 頑張りました！基礎から復習してみましょう。';
            }
            
            document.getElementById('resultMessage').textContent = message;
        }

        // クイズ再開
        function restartQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswers = [];
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('quizGame').classList.remove('hidden');
            showQuestion();
        }

        // クイズ選択に戻る
        function backToTypes() {
            document.getElementById('quizResults').classList.add('hidden');
            document.getElementById('quizGame').classList.add('hidden');
            document.getElementById('quizTypes').style.display = 'grid';
        }

        // ホームに戻る
        function goHome() {
            window.location.href = '/';
        }

        // クイズ終了
        function endQuiz() {
            if (confirm('クイズを終了しますか？')) {
                backToTypes();
            }
        }

        // プログレス更新
        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${currentQuestionIndex + 1}/${currentQuiz.length}`;
        }

        // テーマ切り替え
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.querySelector('.theme-icon');
            
            const savedTheme = localStorage.getItem('theme') || 
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            
            setTheme(savedTheme);
            
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });
            
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                themeIcon.textContent = theme === 'dark' ? '☀️' : '🌙';
            }
        }

        // モバイルメニュー
        function initMobileMenu() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const navbarMenu = document.getElementById('navbarMenu');
            
            if (mobileMenuToggle && navbarMenu) {
                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenuToggle.classList.toggle('active');
                    navbarMenu.classList.toggle('active');
                });
                
                document.addEventListener('click', (e) => {
                    if (!mobileMenuToggle.contains(e.target) && !navbarMenu.contains(e.target)) {
                        mobileMenuToggle.classList.remove('active');
                        navbarMenu.classList.remove('active');
                    }
                });
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            initMobileMenu();
        });
    </script>
</body>
</html>