<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyWineMemory - è¶…è©³ç´°ãƒ¯ã‚¤ãƒ³è¨˜éŒ²&ã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒª</title>
    
    <!-- PWAè¨­å®š -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WineMemory">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    
    <!-- é«˜åº¦ãªã‚¹ã‚¿ã‚¤ãƒ« -->
    <link rel="stylesheet" href="/advanced-style.css">
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="wine-glass-animation">
                <div class="glass">
                    <div class="wine"></div>
                </div>
            </div>
            <div class="loading-text">MyWineMemory</div>
            <div class="loading-subtext">æœ€é«˜ã®ãƒ¯ã‚¤ãƒ³ä½“é¨“ã‚’ãŠå±Šã‘ã—ã¾ã™</div>
        </div>
    </div>

    <!-- Professional Navigation Header -->
    <nav class="main-navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <span class="brand-icon">ğŸ·</span>
                <span class="brand-text">MyWineMemory</span>
            </div>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <div class="navbar-menu" id="navbarMenu">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showSection('home')">
                            <span class="nav-icon">ğŸ </span>
                            <span class="nav-text">ãƒ›ãƒ¼ãƒ </span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showSection('quiz')">
                            <span class="nav-icon">ğŸ§ </span>
                            <span class="nav-text">ã‚¯ã‚¤ã‚º</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showSection('analytics')">
                            <span class="nav-icon">ğŸ“Š</span>
                            <span class="nav-text">åˆ†æ</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showUltraAdvancedForm()">
                            <span class="nav-icon">ğŸ“</span>
                            <span class="nav-text">è©³ç´°è¨˜éŒ²</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button id="theme-toggle" class="theme-toggle nav-link nav-button" aria-label="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ">
                            <span class="theme-icon">ğŸŒ™</span>
                            <span class="nav-text">ãƒ†ãƒ¼ãƒ</span>
                        </button>
                    </li>
                    <li class="nav-item auth-nav" id="authNavItem">
                        <button class="nav-link nav-button" id="authNavButton" onclick="signInWithGoogle()">
                            <span class="nav-icon">ğŸ‘¤</span>
                            <span class="nav-text">ãƒ­ã‚°ã‚¤ãƒ³</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Home Section -->
        <div id="homeSection" class="section active">
            <div class="hero-section">
                <h1 class="hero-title">ğŸ· MyWineMemory</h1>
                <p class="hero-subtitle">ã‚ãªãŸã®ãƒ¯ã‚¤ãƒ³ä½“é¨“ã‚’è¨˜éŒ²ã—ã€çŸ¥è­˜ã‚’æ·±ã‚ã¾ã—ã‚‡ã†</p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalWines">0</span>
                        <span class="stat-label">è¨˜éŒ²æ•°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="avgRating">0.0</span>
                        <span class="stat-label">å¹³å‡è©•ä¾¡</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="quizScore">0</span>
                        <span class="stat-label">ã‚¯ã‚¤ã‚ºã‚¹ã‚³ã‚¢</span>
                    </div>
                </div>
            </div>

            <!-- ãƒ¯ã‚¤ãƒ³æ©Ÿèƒ½ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="wine-features" id="wineFeaturesSection">
                <div class="feature-cards">
                    <div class="feature-card" onclick="showUltraAdvancedForm()">
                        <div class="feature-icon">ğŸ“</div>
                        <h3>è©³ç´°ãƒ¯ã‚¤ãƒ³è¨˜éŒ²</h3>
                        <p>ãƒ—ãƒ­ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒãƒ¼ãƒˆã‚’è¨˜éŒ²</p>
                    </div>
                    
                    <div class="feature-card" onclick="showSection('analytics')">
                        <div class="feature-icon">ğŸ“Š</div>
                        <h3>åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
                        <p>ã‚ãªãŸã®ãƒ¯ã‚¤ãƒ³å‚¾å‘ã‚’è©³ã—ãåˆ†æ</p>
                    </div>
                </div>
                
                <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="authStatus" class="status hidden"></div>
            </div>

            <!-- ãƒ¯ã‚¤ãƒ³ä¸€è¦§ -->
            <div class="wine-showcase" id="wineShowcase">
                <h2>æœ€è¿‘ã®è¨˜éŒ²</h2>
                <div id="recentWines" class="wine-grid">
                    <p class="empty-state">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãƒ¯ã‚¤ãƒ³ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>
                </div>
            </div>
        </div>

        <!-- Quiz Section -->
        <div id="quizSection" class="section">
            <div class="quiz-container">
                <div class="quiz-header">
                    <h1>ğŸ§  ãƒ¯ã‚¤ãƒ³çŸ¥è­˜ã‚¯ã‚¤ã‚º</h1>
                    <p>ã‚ãªãŸã®ãƒ¯ã‚¤ãƒ³çŸ¥è­˜ã‚’ãƒ†ã‚¹ãƒˆã—ã€ã‚¹ã‚­ãƒ«ã‚’å‘ä¸Šã•ã›ã¾ã—ã‚‡ã†</p>
                </div>
                
                <div class="quiz-types">
                    <div class="quiz-type-card" onclick="startQuiz('basic')">
                        <div class="quiz-icon">ğŸ‡</div>
                        <h3>åŸºæœ¬ã‚¯ã‚¤ã‚º</h3>
                        <p>ãƒ¯ã‚¤ãƒ³ã®åŸºç¤çŸ¥è­˜ã‚’ãƒ†ã‚¹ãƒˆ</p>
                    </div>
                    <div class="quiz-type-card" onclick="startQuiz('advanced')">
                        <div class="quiz-icon">ğŸ†</div>
                        <h3>ä¸Šç´šã‚¯ã‚¤ã‚º</h3>
                        <p>ä¸Šç´šè€…å‘ã‘ã®é›£ã—ã„å•é¡Œ</p>
                    </div>
                    <div class="quiz-type-card" onclick="startQuiz('regions')">
                        <div class="quiz-icon">ğŸŒ</div>
                        <h3>ç”£åœ°ã‚¯ã‚¤ã‚º</h3>
                        <p>ä¸–ç•Œã®ãƒ¯ã‚¤ãƒ³ç”£åœ°ã«ã¤ã„ã¦</p>
                    </div>
                    <div class="quiz-type-card" onclick="startQuiz('tasting')">
                        <div class="quiz-icon">ğŸ‘…</div>
                        <h3>ãƒ†ã‚¤ã‚¹ãƒ†ã‚£ãƒ³ã‚°</h3>
                        <p>å‘³ã‚ã„ã‚„é¦™ã‚Šã®ç‰¹å¾´</p>
                    </div>
                </div>
                
                <div id="quizGame" class="quiz-game hidden">
                    <div class="quiz-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">1/10</span>
                    </div>
                    
                    <div class="quiz-question">
                        <h2 id="questionText"></h2>
                        <div id="questionOptions" class="quiz-options"></div>
                    </div>
                    
                    <div class="quiz-controls">
                        <button id="nextButton" class="btn primary-btn" onclick="nextQuestion()" disabled>æ¬¡ã¸</button>
                        <button class="btn outline-btn" onclick="endQuiz()">çµ‚äº†</button>
                    </div>
                </div>
                
                <div id="quizResults" class="quiz-results hidden">
                    <h2>ã‚¯ã‚¤ã‚ºçµæœ</h2>
                    <div class="result-score">
                        <span class="score-number" id="finalScore">0</span>
                        <span class="score-total">/10</span>
                    </div>
                    <div class="result-message" id="resultMessage"></div>
                    <div class="result-actions">
                        <button class="btn primary-btn" onclick="restartQuiz()">ã‚‚ã†ä¸€åº¦</button>
                        <button class="btn outline-btn" onclick="showSection('home')">ãƒ›ãƒ¼ãƒ ã¸</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analyticsSection" class="section">
            <div class="analytics-container">
                <h1>ğŸ“Š ãƒ¯ã‚¤ãƒ³åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>è©•ä¾¡åˆ†å¸ƒ</h3>
                        <canvas id="ratingChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>ãƒ¯ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—åˆ¥</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>æœˆåˆ¥è¨˜éŒ²æ•°</h3>
                        <canvas id="monthlyChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>ä¾¡æ ¼å¸¯åˆ¥</h3>
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ultra Advanced Wine Form -->
        <div class="ultra-advanced-form" id="ultraAdvancedForm" style="display: none;">
            <div class="form-header">
                <h2>è¶…è©³ç´°ãƒ¯ã‚¤ãƒ³è¨˜éŒ²</h2>
                <button type="button" class="close-form-btn" onclick="hideUltraAdvancedForm()">&times;</button>
            </div>
            
            <form id="ultraWineForm" onsubmit="saveUltraWineRecord(event)" class="ultra-form">
                <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="form-section">
                    <h3>ãƒ¯ã‚¤ãƒ³åŸºæœ¬æƒ…å ±</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="wineName">ãƒ¯ã‚¤ãƒ³å:</label>
                            <input type="text" id="wineName" name="wineName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="producer">ç”Ÿç”£è€…:</label>
                            <input type="text" id="producer" name="producer" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="region">ç”£åœ°:</label>
                            <input type="text" id="region" name="region" placeholder="ãƒ•ãƒ©ãƒ³ã‚¹ ãƒœãƒ«ãƒ‰ãƒ¼">
                        </div>
                        
                        <div class="form-group">
                            <label for="vintage">ãƒ´ã‚£ãƒ³ãƒ†ãƒ¼ã‚¸:</label>
                            <input type="number" id="vintage" name="vintage" min="1900" max="2030">
                        </div>
                        
                        <div class="form-group">
                            <label for="price">ä¾¡æ ¼ (å††):</label>
                            <input type="number" id="price" name="price" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="purchaseDate">è³¼å…¥æ—¥:</label>
                            <input type="date" id="purchaseDate" name="purchaseDate">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ãƒ¯ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—:</label>
                        <div class="radio-grid">
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="red" required>
                                <span>èµ¤ãƒ¯ã‚¤ãƒ³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="white">
                                <span>ç™½ãƒ¯ã‚¤ãƒ³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="rose">
                                <span>ãƒ­ã‚¼ãƒ¯ã‚¤ãƒ³</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="sparkling">
                                <span>ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚°</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="grapes">ãƒ–ãƒ‰ã‚¦å“ç¨®:</label>
                            <input type="text" id="grapes" name="grapes" placeholder="ã‚«ãƒ™ãƒ«ãƒãƒ»ã‚½ãƒ¼ãƒ´ã‚£ãƒ‹ãƒ¨ãƒ³ 70%, ãƒ¡ãƒ«ãƒ­ãƒ¼ 30%">
                        </div>
                        <div class="form-group">
                            <label for="alcohol">ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«åº¦æ•° (%):</label>
                            <input type="number" id="alcohol" name="alcohol" min="0" max="20" step="0.1">
                        </div>
                    </div>
                </div>
                
                <!-- å¤–è¦³åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="form-section">
                    <h3>å¤–è¦³åˆ†æ</h3>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <h4>è‰²èª¿</h4>
                            <div class="radio-grid">
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="purple">
                                    <span>ç´«ãŒã‹ã£ãŸ</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="ruby">
                                    <span>ãƒ«ãƒ“ãƒ¼è‰²</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="garnet">
                                    <span>ã‚¬ãƒ¼ãƒãƒƒãƒˆè‰²</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="golden">
                                    <span>é‡‘è‰²</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="analysis-item">
                            <h4>æ¿ƒæ·¡</h4>
                            <div class="radio-grid">
                                <label class="radio-item">
                                    <input type="radio" name="colorIntensity" value="pale">
                                    <span>æ·¡ã„</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorIntensity" value="medium">
                                    <span>ä¸­ç¨‹åº¦</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorIntensity" value="deep">
                                    <span>æ¿ƒã„</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="analysis-item">
                            <h4>é€æ˜åº¦</h4>
                            <div class="radio-grid">
                                <label class="radio-item">
                                    <input type="radio" name="clarity" value="clear">
                                    <span>æ¾„æ˜</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="clarity" value="hazy">
                                    <span>ã‚„ã‚„æ¿ã‚Š</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="clarity" value="opaque">
                                    <span>ä¸é€æ˜</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- é¦™ã‚Šåˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="form-section">
                    <h3>é¦™ã‚Šåˆ†æ</h3>
                    <div class="aroma-analysis">
                        <div class="aroma-category">
                            <h4>ãƒ•ãƒ«ãƒ¼ãƒ„ç³»</h4>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="blackberry">
                                    <span>ãƒ–ãƒ©ãƒƒã‚¯ãƒ™ãƒªãƒ¼</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="cherry">
                                    <span>ãƒã‚§ãƒªãƒ¼</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="plum">
                                    <span>ãƒ—ãƒ©ãƒ </span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="citrus">
                                    <span>æŸ‘æ©˜ç³»</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="aroma-category">
                            <h4>ã‚¹ãƒ‘ã‚¤ã‚¹ç³»</h4>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="vanilla">
                                    <span>ãƒãƒ‹ãƒ©</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="pepper">
                                    <span>ã‚³ã‚·ãƒ§ã‚¦</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="cinnamon">
                                    <span>ã‚·ãƒŠãƒ¢ãƒ³</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="clove">
                                    <span>ã‚¯ãƒ­ãƒ¼ãƒ–</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="aroma-category">
                            <h4>ã‚¢ãƒ¼ã‚·ãƒ¼ç³»</h4>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="oak">
                                    <span>ã‚ªãƒ¼ã‚¯</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="tobacco">
                                    <span>ã‚¿ãƒã‚³</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="leather">
                                    <span>é©</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="earth">
                                    <span>åœŸç³»</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å‘³ã‚ã„åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="form-section">
                    <h3>å‘³ã‚ã„åˆ†æ</h3>
                    <div class="taste-analysis">
                        <div class="taste-scale">
                            <label>ç”˜å‘³ (1-5):</label>
                            <div class="star-rating" data-rating="sweetness">
                                <span class="star" data-value="1">â˜…</span>
                                <span class="star" data-value="2">â˜…</span>
                                <span class="star" data-value="3">â˜…</span>
                                <span class="star" data-value="4">â˜…</span>
                                <span class="star" data-value="5">â˜…</span>
                            </div>
                            <input type="hidden" name="sweetness" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>é…¸å‘³ (1-5):</label>
                            <div class="star-rating" data-rating="acidity">
                                <span class="star" data-value="1">â˜…</span>
                                <span class="star" data-value="2">â˜…</span>
                                <span class="star" data-value="3">â˜…</span>
                                <span class="star" data-value="4">â˜…</span>
                                <span class="star" data-value="5">â˜…</span>
                            </div>
                            <input type="hidden" name="acidity" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>ã‚¿ãƒ³ãƒ‹ãƒ³ (1-5):</label>
                            <div class="star-rating" data-rating="tannin">
                                <span class="star" data-value="1">â˜…</span>
                                <span class="star" data-value="2">â˜…</span>
                                <span class="star" data-value="3">â˜…</span>
                                <span class="star" data-value="4">â˜…</span>
                                <span class="star" data-value="5">â˜…</span>
                            </div>
                            <input type="hidden" name="tannin" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>ãƒœãƒ‡ã‚£ (1-5):</label>
                            <div class="star-rating" data-rating="body">
                                <span class="star" data-value="1">â˜…</span>
                                <span class="star" data-value="2">â˜…</span>
                                <span class="star" data-value="3">â˜…</span>
                                <span class="star" data-value="4">â˜…</span>
                                <span class="star" data-value="5">â˜…</span>
                            </div>
                            <input type="hidden" name="body" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ (1-5):</label>
                            <div class="star-rating" data-rating="finish">
                                <span class="star" data-value="1">â˜…</span>
                                <span class="star" data-value="2">â˜…</span>
                                <span class="star" data-value="3">â˜…</span>
                                <span class="star" data-value="4">â˜…</span>
                                <span class="star" data-value="5">â˜…</span>
                            </div>
                            <input type="hidden" name="finish" value="0">
                        </div>
                    </div>
                </div>
                
                <!-- ç·åˆè©•ä¾¡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="form-section">
                    <h3>ç·åˆè©•ä¾¡</h3>
                    <div class="overall-rating">
                        <label>ç·åˆè©•ä¾¡ (1-5):</label>
                        <div class="star-rating" data-rating="wineRating">
                            <span class="star" data-value="1">â˜…</span>
                            <span class="star" data-value="2">â˜…</span>
                            <span class="star" data-value="3">â˜…</span>
                            <span class="star" data-value="4">â˜…</span>
                            <span class="star" data-value="5">â˜…</span>
                        </div>
                        <input type="hidden" name="wineRating" value="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">è©³ç´°ãƒ¡ãƒ¢:</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="å‘³ã‚ã„ã€å°è±¡ã€ãƒšã‚¢ãƒªãƒ³ã‚°æ¨å¥¨ãªã©ã‚’è¨˜éŒ²"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="foodPairing">ãƒ•ãƒ¼ãƒ‰ãƒšã‚¢ãƒªãƒ³ã‚°:</label>
                        <input type="text" id="foodPairing" name="foodPairing" placeholder="ã‚¹ãƒ†ãƒ¼ã‚­ã€ãƒãƒ¼ã‚ºã€ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆãªã©">
                    </div>
                    
                    <div class="form-group">
                        <label for="occasion">é£²ç”¨ã‚·ãƒ¼ãƒ³:</label>
                        <input type="text" id="occasion" name="occasion" placeholder="èª•ç”Ÿæ—¥ã€ãƒ‡ã‚£ãƒŠãƒ¼ã€ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ãªã©">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn primary-btn">è©³ç´°è¨˜éŒ²ã‚’ä¿å­˜</button>
                    <button type="button" class="btn outline-btn" onclick="hideUltraAdvancedForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </form>
        </div>

        <!-- ãƒ¯ã‚¤ãƒ³ä¸€è¦§ -->
        <div class="wine-list" id="wineListSection" style="display: none;">
            <h2>è¨˜éŒ²ã•ã‚ŒãŸãƒ¯ã‚¤ãƒ³</h2>
            <div id="wineRecords">
                <p>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãƒ¯ã‚¤ãƒ³ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (CDN) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut as firebaseSignOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, where, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyB6jnGUsdR9JDTZoDUq_QhM4Gr_gLVp3qA",
            authDomain: "mywinememory.firebaseapp.com",
            projectId: "mywinememory",
            storageBucket: "mywinememory.firebasestorage.app",
            messagingSenderId: "179280253269",
            appId: "1:179280253269:web:58330b5938412fafc21fdc",
            measurementId: "G-PP1B5425FD"
        };

        // FirebaseåˆæœŸåŒ–
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentUser = null;
        let wineRecords = [];
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let charts = {};

        // ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿
        const quizData = {
            basic: [
                {
                    question: "ãƒ•ãƒ©ãƒ³ã‚¹ã®ä»£è¡¨çš„ãªãƒ¯ã‚¤ãƒ³ç”£åœ°ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
                    options: ["ãƒœãƒ«ãƒ‰ãƒ¼", "ãƒˆã‚¹ã‚«ãƒ¼ãƒŠ", "ãƒŠãƒ‘ãƒãƒ¬ãƒ¼", "ãƒ¢ãƒ¼ã‚¼ãƒ«"],
                    correct: 0
                },
                {
                    question: "èµ¤ãƒ¯ã‚¤ãƒ³ã®ä¸»ãªè‰²ç´ æˆåˆ†ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                    options: ["ã‚¿ãƒ³ãƒ‹ãƒ³", "ã‚¢ãƒ³ãƒˆã‚·ã‚¢ãƒ‹ãƒ³", "ãƒ¬ã‚¹ãƒ™ãƒ©ãƒˆãƒ­ãƒ¼ãƒ«", "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«"],
                    correct: 1
                },
                {
                    question: "ã‚·ãƒ£ãƒ³ãƒ‘ãƒ¼ãƒ‹ãƒ¥ã®è£½æ³•ã¨ã—ã¦æ­£ã—ã„ã®ã¯ã©ã‚Œã§ã™ã‹ï¼Ÿ",
                    options: ["ã‚·ãƒ£ãƒ«ãƒæ–¹å¼", "ãƒ¡ãƒˆãƒ¼ãƒ‰ãƒ»ã‚·ãƒ£ãƒ³ãƒ—ãƒãƒ¯ãƒ¼ã‚º", "ç‚­é…¸æ³¨å…¥", "è‡ªç„¶ç™ºé…µ"],
                    correct: 1
                }
            ],
            advanced: [
                {
                    question: "ãƒœãƒ«ãƒ‰ãƒ¼ã®å·¦å²¸ã§ä¸»ã«æ ½åŸ¹ã•ã‚Œã‚‹ãƒ–ãƒ‰ã‚¦å“ç¨®ã¯ï¼Ÿ",
                    options: ["ãƒ¡ãƒ«ãƒ­ãƒ¼", "ã‚«ãƒ™ãƒ«ãƒãƒ»ã‚½ãƒ¼ãƒ´ã‚£ãƒ‹ãƒ¨ãƒ³", "ãƒ”ãƒãƒ»ãƒãƒ¯ãƒ¼ãƒ«", "ã‚·ãƒ©ãƒ¼"],
                    correct: 1
                },
                {
                    question: "ãƒãƒ­ãƒ©ã‚¯ãƒ†ã‚£ãƒƒã‚¯ç™ºé…µã®ç›®çš„ã¯ï¼Ÿ",
                    options: ["ç³–åˆ†ã‚’ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ã«å¤‰æ›", "é…¸å‘³ã‚’å’Œã‚‰ã’ã‚‹", "è‰²ç´ ã‚’æŠ½å‡º", "ã‚¿ãƒ³ãƒ‹ãƒ³ã‚’é™¤å»"],
                    correct: 1
                }
            ],
            regions: [
                {
                    question: "ãƒ–ãƒ«ã‚´ãƒ¼ãƒ‹ãƒ¥ã®ä»£è¡¨çš„ãªç™½ãƒ–ãƒ‰ã‚¦å“ç¨®ã¯ï¼Ÿ",
                    options: ["ã‚·ãƒ£ãƒ«ãƒ‰ãƒ", "ã‚½ãƒ¼ãƒ´ã‚£ãƒ‹ãƒ¨ãƒ³ãƒ»ãƒ–ãƒ©ãƒ³", "ãƒªãƒ¼ã‚¹ãƒªãƒ³ã‚°", "ã‚²ãƒ´ãƒ¥ãƒ«ãƒ„ãƒˆãƒ©ãƒŸãƒŠãƒ¼"],
                    correct: 0
                },
                {
                    question: "ã‚­ãƒ£ãƒ³ãƒ†ã‚£ã¯ã©ã®å›½ã®ãƒ¯ã‚¤ãƒ³ã§ã™ã‹ï¼Ÿ",
                    options: ["ãƒ•ãƒ©ãƒ³ã‚¹", "ã‚¤ã‚¿ãƒªã‚¢", "ã‚¹ãƒšã‚¤ãƒ³", "ãƒ‰ã‚¤ãƒ„"],
                    correct: 1
                }
            ],
            tasting: [
                {
                    question: "ãƒ¯ã‚¤ãƒ³ã®ã€Œãƒœãƒ‡ã‚£ã€ã¨ã¯ä½•ã‚’è¡¨ã—ã¾ã™ã‹ï¼Ÿ",
                    options: ["è‰²ã®æ¿ƒã•", "é¦™ã‚Šã®å¼·ã•", "å‘³ã‚ã„ã®åšã¿", "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«åº¦æ•°"],
                    correct: 2
                },
                {
                    question: "ã‚¿ãƒ³ãƒ‹ãƒ³ãŒå¤šã„ãƒ¯ã‚¤ãƒ³ã®ç‰¹å¾´ã¯ï¼Ÿ",
                    options: ["ç”˜ã„", "æ¸‹ã„", "é…¸ã£ã±ã„", "å¡©è¾›ã„"],
                    correct: 1
                }
            ]
        };

        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã®åˆ¶å¾¡
        function showLoadingOverlay(show, message = '') {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.style.display = 'flex';
                if (message) {
                    const subtext = overlay.querySelector('.loading-subtext');
                    subtext.textContent = message;
                }
            } else {
                overlay.style.display = 'none';
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ· MyWineMemory - Ultra Advancedç‰ˆã‚’åˆæœŸåŒ–ä¸­...');
            
            showLoadingOverlay(true, 'ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æº–å‚™ä¸­...');
            
            // æœ€ä½3ç§’é–“ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¡¨ç¤º
            setTimeout(() => {
                showLoadingOverlay(false);
            }, 3000);

            initTheme();
            initMobileMenu();
            initStarRatings();
        });

        // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateUI();
            if (user) {
                loadWineRecords();
                updateStats();
            }
        });

        // UIæ›´æ–°
        function updateUI() {
            const authNavButton = document.getElementById('authNavButton');
            const authNavIcon = authNavButton.querySelector('.nav-icon');
            const authNavText = authNavButton.querySelector('.nav-text');
            const wineFeaturesSection = document.getElementById('wineFeaturesSection');

            if (currentUser) {
                // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼‹ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤‰æ›´
                authNavIcon.textContent = 'ğŸ‘‹';
                authNavText.textContent = currentUser.displayName?.split(' ')[0] || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
                authNavButton.onclick = () => {
                    if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                        signOut();
                    }
                };
                
                // ãƒ¯ã‚¤ãƒ³æ©Ÿèƒ½ã‚’è¡¨ç¤º
                wineFeaturesSection.style.display = 'block';
            } else {
                // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã«å¤‰æ›´
                authNavIcon.textContent = 'ğŸ‘¤';
                authNavText.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
                authNavButton.onclick = signInWithGoogle;
                
                // ãƒ¯ã‚¤ãƒ³æ©Ÿèƒ½ã‚’éè¡¨ç¤ºï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼‰
                wineFeaturesSection.innerHTML = `
                    <div class="login-required">
                        <h2>ğŸ· MyWineMemory</h2>
                        <p>ãƒ¯ã‚¤ãƒ³ã®è¨˜éŒ²ã¨åˆ†æã‚’å§‹ã‚ã‚‹ã«ã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</p>
                    </div>
                `;
            }
        }

        // Googleãƒ­ã‚°ã‚¤ãƒ³
        window.signInWithGoogle = async function() {
            console.log('ğŸ” Google login attempt started');
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                console.log('âœ… Google login successful');
                showStatus('ãƒ­ã‚°ã‚¤ãƒ³ã«æˆåŠŸã—ã¾ã—ãŸ', 'success');
            } catch (error) {
                console.error('âŒ Google login failed:', error);
                showStatus('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            }
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        window.signOut = async function() {
            try {
                await firebaseSignOut(auth);
                showStatus('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ', 'success');
                document.getElementById('wineRecords').innerHTML = '<p>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãƒ¯ã‚¤ãƒ³ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>';
                wineRecords = [];
                updateStats();
            } catch (error) {
                showStatus('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        window.showSection = function(sectionName) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å ´åˆã€ãƒãƒ£ãƒ¼ãƒˆã‚’åˆæœŸåŒ–
            if (sectionName === 'analytics') {
                initAnalytics();
            }
        }

        // è¶…è©³ç´°ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
        window.showUltraAdvancedForm = function() {
            if (!currentUser) {
                showStatus('ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            document.getElementById('ultraAdvancedForm').style.display = 'block';
        }

        // è¶…è©³ç´°ãƒ•ã‚©ãƒ¼ãƒ éè¡¨ç¤º
        window.hideUltraAdvancedForm = function() {
            document.getElementById('ultraAdvancedForm').style.display = 'none';
            document.getElementById('ultraWineForm').reset();
            resetStarRatings();
        }

        // è¶…è©³ç´°ãƒ¯ã‚¤ãƒ³è¨˜éŒ²ä¿å­˜
        window.saveUltraWineRecord = async function(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showStatus('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™', 'error');
                return;
            }

            const formData = new FormData(event.target);
            const wineData = {
                wineName: formData.get('wineName'),
                producer: formData.get('producer'),
                region: formData.get('region'),
                vintage: parseInt(formData.get('vintage')) || null,
                price: parseInt(formData.get('price')) || null,
                purchaseDate: formData.get('purchaseDate'),
                wineType: formData.get('wineType'),
                grapes: formData.get('grapes'),
                alcohol: parseFloat(formData.get('alcohol')) || null,
                colorTone: formData.get('colorTone'),
                colorIntensity: formData.get('colorIntensity'),
                clarity: formData.get('clarity'),
                aroma: formData.getAll('aroma'),
                sweetness: parseInt(formData.get('sweetness')),
                acidity: parseInt(formData.get('acidity')),
                tannin: parseInt(formData.get('tannin')),
                body: parseInt(formData.get('body')),
                finish: parseInt(formData.get('finish')),
                wineRating: parseInt(formData.get('wineRating')),
                notes: formData.get('notes'),
                foodPairing: formData.get('foodPairing'),
                occasion: formData.get('occasion'),
                userId: currentUser.uid,
                createdAt: new Date()
            };

            try {
                await addDoc(collection(db, 'wine_records'), wineData);
                showStatus('è©³ç´°ãƒ¯ã‚¤ãƒ³è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼', 'success');
                hideUltraAdvancedForm();
                loadWineRecords();
                updateStats();
            } catch (error) {
                showStatus('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            }
        }

        // ãƒ¯ã‚¤ãƒ³è¨˜éŒ²èª­ã¿è¾¼ã¿
        async function loadWineRecords() {
            if (!currentUser) return;

            try {
                const q = query(
                    collection(db, 'wine_records'),
                    where('userId', '==', currentUser.uid),
                    orderBy('createdAt', 'desc'),
                    limit(6)
                );
                
                const querySnapshot = await getDocs(q);
                const recentWinesContainer = document.getElementById('recentWines');
                
                if (querySnapshot.empty) {
                    recentWinesContainer.innerHTML = '<p class="empty-state">ã¾ã ãƒ¯ã‚¤ãƒ³ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æœ€åˆã®ãƒ¯ã‚¤ãƒ³ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</p>';
                    return;
                }

                let html = '';
                wineRecords = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    wineRecords.push(data);
                    html += `
                        <div class="wine-card">
                            <h3>${data.wineName}</h3>
                            <p class="producer">${data.producer}</p>
                            ${data.region ? `<p class="region">${data.region}</p>` : ''}
                            <div class="rating">${'â­'.repeat(data.wineRating || 0)}</div>
                            ${data.notes ? `<p class="notes">${data.notes.substring(0, 100)}...</p>` : ''}
                        </div>
                    `;
                });
                
                recentWinesContainer.innerHTML = html;
            } catch (error) {
                showStatus('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
            }
        }

        // çµ±è¨ˆæƒ…å ±æ›´æ–°
        function updateStats() {
            const totalWinesEl = document.getElementById('totalWines');
            const avgRatingEl = document.getElementById('avgRating');
            
            if (wineRecords.length > 0) {
                totalWinesEl.textContent = wineRecords.length;
                const avgRating = wineRecords.reduce((sum, wine) => sum + (wine.wineRating || 0), 0) / wineRecords.length;
                avgRatingEl.textContent = avgRating.toFixed(1);
            } else {
                totalWinesEl.textContent = '0';
                avgRatingEl.textContent = '0.0';
            }
        }

        // ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½
        window.startQuiz = function(type) {
            currentQuiz = quizData[type];
            currentQuestionIndex = 0;
            score = 0;
            
            document.querySelector('.quiz-types').style.display = 'none';
            document.getElementById('quizGame').classList.remove('hidden');
            
            showQuestion();
        }

        function showQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('questionOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'quiz-option';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            updateProgress();
            document.getElementById('nextButton').disabled = true;
        }

        function selectAnswer(selectedIndex) {
            const question = currentQuiz[currentQuestionIndex];
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach((option, index) => {
                option.disabled = true;
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === question.correct) {
                score++;
            }
            
            document.getElementById('nextButton').disabled = false;
        }

        window.nextQuestion = function() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= currentQuiz.length) {
                showQuizResults();
            } else {
                showQuestion();
            }
        }

        function showQuizResults() {
            document.getElementById('quizGame').classList.add('hidden');
            const resultsContainer = document.getElementById('quizResults');
            resultsContainer.classList.remove('hidden');
            
            document.getElementById('finalScore').textContent = score;
            
            let message = '';
            const percentage = (score / currentQuiz.length) * 100;
            if (percentage >= 80) {
                message = 'ã™ã°ã‚‰ã—ã„ï¼ãƒ¯ã‚¤ãƒ³ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã§ã™ã­ï¼';
            } else if (percentage >= 60) {
                message = 'ã‚ˆãã§ãã¾ã—ãŸï¼ã‚‚ã†å°‘ã—ã§å®Œç’§ã§ã™ã€‚';
            } else {
                message = 'é ‘å¼µã‚Šã¾ã—ãŸï¼ã•ã‚‰ã«å­¦ç¿’ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚';
            }
            
            document.getElementById('resultMessage').textContent = message;
        }

        window.restartQuiz = function() {
            document.getElementById('quizResults').classList.add('hidden');
            document.querySelector('.quiz-types').style.display = 'grid';
        }

        window.endQuiz = function() {
            document.getElementById('quizGame').classList.add('hidden');
            document.querySelector('.quiz-types').style.display = 'grid';
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${currentQuestionIndex + 1}/${currentQuiz.length}`;
        }

        // ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹åˆæœŸåŒ–
        function initAnalytics() {
            if (wineRecords.length === 0) return;

            // è©•ä¾¡åˆ†å¸ƒãƒãƒ£ãƒ¼ãƒˆ
            if (charts.ratingChart) charts.ratingChart.destroy();
            const ratingCtx = document.getElementById('ratingChart').getContext('2d');
            const ratingData = [1, 2, 3, 4, 5].map(rating => 
                wineRecords.filter(wine => wine.wineRating === rating).length
            );
            
            charts.ratingChart = new Chart(ratingCtx, {
                type: 'bar',
                data: {
                    labels: ['1â­', '2â­', '3â­', '4â­', '5â­'],
                    datasets: [{
                        label: 'è¨˜éŒ²æ•°',
                        data: ratingData,
                        backgroundColor: 'rgba(102, 126, 234, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // ãƒ¯ã‚¤ãƒ³ã‚¿ã‚¤ãƒ—åˆ¥ãƒãƒ£ãƒ¼ãƒˆ
            if (charts.typeChart) charts.typeChart.destroy();
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            const types = ['red', 'white', 'rose', 'sparkling'];
            const typeData = types.map(type => 
                wineRecords.filter(wine => wine.wineType === type).length
            );
            
            charts.typeChart = new Chart(typeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['èµ¤ãƒ¯ã‚¤ãƒ³', 'ç™½ãƒ¯ã‚¤ãƒ³', 'ãƒ­ã‚¼', 'ã‚¹ãƒ‘ãƒ¼ã‚¯ãƒªãƒ³ã‚°'],
                    datasets: [{
                        data: typeData,
                        backgroundColor: ['#dc2626', '#fbbf24', '#f472b6', '#60a5fa']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // ã‚¹ã‚¿ãƒ¼è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
        function initStarRatings() {
            const starRatings = document.querySelectorAll('.star-rating');
            
            starRatings.forEach(rating => {
                const stars = rating.querySelectorAll('.star');
                const ratingName = rating.getAttribute('data-rating');
                const hiddenInput = document.querySelector(`input[name="${ratingName}"]`);
                
                stars.forEach(star => {
                    star.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        hiddenInput.value = value;
                        
                        stars.forEach((s, index) => {
                            if (index < value) {
                                s.classList.add('active');
                            } else {
                                s.classList.remove('active');
                            }
                        });
                    });
                });
            });
        }

        function resetStarRatings() {
            const stars = document.querySelectorAll('.star');
            const hiddenInputs = document.querySelectorAll('.star-rating + input[type="hidden"]');
            
            stars.forEach(star => star.classList.remove('active'));
            hiddenInputs.forEach(input => input.value = '0');
        }

        // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.querySelector('.theme-icon');
            
            const savedTheme = localStorage.getItem('theme') || 
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            
            setTheme(savedTheme);
            
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });
            
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                themeIcon.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            }
        }

        // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¶å¾¡
        function initMobileMenu() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const navbarMenu = document.getElementById('navbarMenu');
            
            if (mobileMenuToggle && navbarMenu) {
                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenuToggle.classList.toggle('active');
                    navbarMenu.classList.toggle('active');
                });
                
                const navLinks = navbarMenu.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenuToggle.classList.remove('active');
                        navbarMenu.classList.remove('active');
                    });
                });
                
                document.addEventListener('click', (e) => {
                    if (!mobileMenuToggle.contains(e.target) && !navbarMenu.contains(e.target)) {
                        mobileMenuToggle.classList.remove('active');
                        navbarMenu.classList.remove('active');
                    }
                });
            }
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        function showStatus(message, type) {
            const statusEl = document.getElementById('authStatus');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
            
            setTimeout(() => {
                statusEl.classList.add('hidden');
            }, 3000);
        }

        console.log('ğŸ· MyWineMemory Ultra Advanced initialized successfully');
    </script>

    <!-- Service Workerç™»éŒ² -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then((registration) => {
                    console.log('Service Worker registered');
                    
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showUpdateAvailable();
                            }
                        });
                    });
                })
                .catch(err => console.log('Service Worker registration failed:', err));
        }

        function showUpdateAvailable() {
            const updateBanner = document.createElement('div');
            updateBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #4CAF50;
                color: white;
                padding: 10px;
                text-align: center;
                z-index: 10000;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
            updateBanner.innerHTML = `
                æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼
                <button onclick="updateApp()" style="margin-left: 10px; padding: 5px 10px; background: white; color: #4CAF50; border: none; border-radius: 3px; cursor: pointer;">
                    æ›´æ–°
                </button>
                <button onclick="this.parentElement.remove()" style="margin-left: 5px; padding: 5px 10px; background: transparent; color: white; border: 1px solid white; border-radius: 3px; cursor: pointer;">
                    å¾Œã§
                </button>
            `;
            document.body.appendChild(updateBanner);
        }

        window.updateApp = function() {
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ action: 'skipWaiting' });
            }
            window.location.reload();
        }
    </script>
</body>
</html>