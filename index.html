<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyWineMemory - Ë∂ÖË©≥Á¥∞„ÉØ„Ç§„É≥Ë®òÈå≤&„ÇØ„Ç§„Ç∫„Ç¢„Éó„É™</title>
    
    <!-- PWAË®≠ÂÆö -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="WineMemory">
    <link rel="apple-touch-icon" href="/icons/icon-192.png">
    
    <!-- È´òÂ∫¶„Å™„Çπ„Çø„Ç§„É´ -->
    <link rel="stylesheet" href="/advanced-style.css">
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="wine-glass-animation">
                <div class="glass">
                    <div class="wine"></div>
                </div>
            </div>
            <div class="loading-text">MyWineMemory</div>
            <div class="loading-subtext">ÊúÄÈ´ò„ÅÆ„ÉØ„Ç§„É≥‰ΩìÈ®ì„Çí„ÅäÂ±ä„Åë„Åó„Åæ„Åô</div>
        </div>
    </div>

    <!-- Professional Navigation Header -->
    <nav class="main-navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <span class="brand-icon">üç∑</span>
                <span class="brand-text">MyWineMemory</span>
            </div>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="„É°„Éã„É•„Éº„ÇíÈñã„Åè">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <div class="navbar-menu" id="navbarMenu">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showSection('home')">
                            <span class="nav-icon">üè†</span>
                            <span class="nav-text">„Éõ„Éº„É†</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showSection('quiz')">
                            <span class="nav-icon">üß†</span>
                            <span class="nav-text">„ÇØ„Ç§„Ç∫</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showSection('analytics')">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">ÂàÜÊûê</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link nav-button" onclick="showUltraAdvancedForm()">
                            <span class="nav-icon">üìù</span>
                            <span class="nav-text">Ë©≥Á¥∞Ë®òÈå≤</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <button id="theme-toggle" class="theme-toggle nav-link nav-button" aria-label="„ÉÜ„Éº„ÉûÂàá„ÇäÊõø„Åà">
                            <span class="theme-icon">üåô</span>
                            <span class="nav-text">„ÉÜ„Éº„Éû</span>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Home Section -->
        <div id="homeSection" class="section active">
            <div class="hero-section">
                <h1 class="hero-title">üç∑ MyWineMemory</h1>
                <p class="hero-subtitle">„ÅÇ„Å™„Åü„ÅÆ„ÉØ„Ç§„É≥‰ΩìÈ®ì„ÇíË®òÈå≤„Åó„ÄÅÁü•Ë≠ò„ÇíÊ∑±„ÇÅ„Åæ„Åó„Çá„ÅÜ</p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalWines">0</span>
                        <span class="stat-label">Ë®òÈå≤Êï∞</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="avgRating">0.0</span>
                        <span class="stat-label">Âπ≥ÂùáË©ï‰æ°</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="quizScore">0</span>
                        <span class="stat-label">„ÇØ„Ç§„Ç∫„Çπ„Ç≥„Ç¢</span>
                    </div>
                </div>
            </div>

            <!-- Ë™çË®º„Çª„ÇØ„Ç∑„Éß„É≥ -->
            <div class="auth-section" id="authSection">
                <div id="loginView">
                    <div class="auth-card">
                        <h2>„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÉØ„Ç§„É≥„ÇíË®òÈå≤</h2>
                        <p>„ÉØ„Ç§„É≥„ÅÆË®òÈå≤„Çí‰øùÂ≠ò„Åó„ÄÅ„ÇØ„Ç§„Ç∫„ÅßÁü•Ë≠ò„ÇíÊ∑±„ÇÅ„Åæ„Åó„Çá„ÅÜ</p>
                        <button class="btn primary-btn" onclick="signInWithGoogle()">
                            <span class="btn-icon">G</span>
                            Google„Åß„É≠„Ç∞„Ç§„É≥
                        </button>
                        <div id="authStatus" class="status hidden"></div>
                    </div>
                </div>
                
                <div id="userView" class="hidden">
                    <div class="user-welcome">
                        <h2>„Çà„ÅÜ„Åì„Åù„ÄÅ<span id="userName"></span>„Åï„Çì</h2>
                        <div class="action-buttons">
                            <button class="btn primary-btn" onclick="showUltraAdvancedForm()">
                                <span class="btn-icon">üìù</span>
                                Ë©≥Á¥∞„ÉØ„Ç§„É≥Ë®òÈå≤
                            </button>
                            <button class="btn secondary-btn" onclick="showSection('quiz')">
                                <span class="btn-icon">üß†</span>
                                „ÉØ„Ç§„É≥„ÇØ„Ç§„Ç∫
                            </button>
                            <button class="btn secondary-btn" onclick="showSection('analytics')">
                                <span class="btn-icon">üìä</span>
                                ÂàÜÊûê„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                            </button>
                            <button class="btn outline-btn" onclick="signOut()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- „ÉØ„Ç§„É≥‰∏ÄË¶ß -->
            <div class="wine-showcase" id="wineShowcase">
                <h2>ÊúÄËøë„ÅÆË®òÈå≤</h2>
                <div id="recentWines" class="wine-grid">
                    <p class="empty-state">„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÉØ„Ç§„É≥„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜ</p>
                </div>
            </div>
        </div>

        <!-- Quiz Section -->
        <div id="quizSection" class="section">
            <div class="quiz-container">
                <div class="quiz-header">
                    <h1>üß† „ÉØ„Ç§„É≥Áü•Ë≠ò„ÇØ„Ç§„Ç∫</h1>
                    <p>„ÅÇ„Å™„Åü„ÅÆ„ÉØ„Ç§„É≥Áü•Ë≠ò„Çí„ÉÜ„Çπ„Éà„Åó„ÄÅ„Çπ„Ç≠„É´„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åó„Çá„ÅÜ</p>
                </div>
                
                <div class="quiz-types">
                    <div class="quiz-type-card" onclick="startQuiz('basic')">
                        <div class="quiz-icon">üçá</div>
                        <h3>Âü∫Êú¨„ÇØ„Ç§„Ç∫</h3>
                        <p>„ÉØ„Ç§„É≥„ÅÆÂü∫Á§éÁü•Ë≠ò„Çí„ÉÜ„Çπ„Éà</p>
                    </div>
                    <div class="quiz-type-card" onclick="startQuiz('advanced')">
                        <div class="quiz-icon">üèÜ</div>
                        <h3>‰∏äÁ¥ö„ÇØ„Ç§„Ç∫</h3>
                        <p>‰∏äÁ¥öËÄÖÂêë„Åë„ÅÆÈõ£„Åó„ÅÑÂïèÈ°å</p>
                    </div>
                    <div class="quiz-type-card" onclick="startQuiz('regions')">
                        <div class="quiz-icon">üåç</div>
                        <h3>Áî£Âú∞„ÇØ„Ç§„Ç∫</h3>
                        <p>‰∏ñÁïå„ÅÆ„ÉØ„Ç§„É≥Áî£Âú∞„Å´„Å§„ÅÑ„Å¶</p>
                    </div>
                    <div class="quiz-type-card" onclick="startQuiz('tasting')">
                        <div class="quiz-icon">üëÖ</div>
                        <h3>„ÉÜ„Ç§„Çπ„ÉÜ„Ç£„É≥„Ç∞</h3>
                        <p>Âë≥„Çè„ÅÑ„ÇÑÈ¶ô„Çä„ÅÆÁâπÂæ¥</p>
                    </div>
                </div>
                
                <div id="quizGame" class="quiz-game hidden">
                    <div class="quiz-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <span class="progress-text" id="progressText">1/10</span>
                    </div>
                    
                    <div class="quiz-question">
                        <h2 id="questionText"></h2>
                        <div id="questionOptions" class="quiz-options"></div>
                    </div>
                    
                    <div class="quiz-controls">
                        <button id="nextButton" class="btn primary-btn" onclick="nextQuestion()" disabled>Ê¨°„Å∏</button>
                        <button class="btn outline-btn" onclick="endQuiz()">ÁµÇ‰∫Ü</button>
                    </div>
                </div>
                
                <div id="quizResults" class="quiz-results hidden">
                    <h2>„ÇØ„Ç§„Ç∫ÁµêÊûú</h2>
                    <div class="result-score">
                        <span class="score-number" id="finalScore">0</span>
                        <span class="score-total">/10</span>
                    </div>
                    <div class="result-message" id="resultMessage"></div>
                    <div class="result-actions">
                        <button class="btn primary-btn" onclick="restartQuiz()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶</button>
                        <button class="btn outline-btn" onclick="showSection('home')">„Éõ„Éº„É†„Å∏</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analytics Section -->
        <div id="analyticsSection" class="section">
            <div class="analytics-container">
                <h1>üìä „ÉØ„Ç§„É≥ÂàÜÊûê„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</h1>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <h3>Ë©ï‰æ°ÂàÜÂ∏É</h3>
                        <canvas id="ratingChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>„ÉØ„Ç§„É≥„Çø„Ç§„ÉóÂà•</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>ÊúàÂà•Ë®òÈå≤Êï∞</h3>
                        <canvas id="monthlyChart"></canvas>
                    </div>
                    <div class="analytics-card">
                        <h3>‰æ°Ê†ºÂ∏ØÂà•</h3>
                        <canvas id="priceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ultra Advanced Wine Form -->
        <div class="ultra-advanced-form" id="ultraAdvancedForm" style="display: none;">
            <div class="form-header">
                <h2>Ë∂ÖË©≥Á¥∞„ÉØ„Ç§„É≥Ë®òÈå≤</h2>
                <button type="button" class="close-form-btn" onclick="hideUltraAdvancedForm()">&times;</button>
            </div>
            
            <form id="ultraWineForm" onsubmit="saveUltraWineRecord(event)" class="ultra-form">
                <!-- Âü∫Êú¨ÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="form-section">
                    <h3>„ÉØ„Ç§„É≥Âü∫Êú¨ÊÉÖÂ†±</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="wineName">„ÉØ„Ç§„É≥Âêç:</label>
                            <input type="text" id="wineName" name="wineName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="producer">ÁîüÁî£ËÄÖ:</label>
                            <input type="text" id="producer" name="producer" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="region">Áî£Âú∞:</label>
                            <input type="text" id="region" name="region" placeholder="„Éï„É©„É≥„Çπ „Éú„É´„Éâ„Éº">
                        </div>
                        
                        <div class="form-group">
                            <label for="vintage">„É¥„Ç£„É≥„ÉÜ„Éº„Ç∏:</label>
                            <input type="number" id="vintage" name="vintage" min="1900" max="2030">
                        </div>
                        
                        <div class="form-group">
                            <label for="price">‰æ°Ê†º (ÂÜÜ):</label>
                            <input type="number" id="price" name="price" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="purchaseDate">Ë≥ºÂÖ•Êó•:</label>
                            <input type="date" id="purchaseDate" name="purchaseDate">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>„ÉØ„Ç§„É≥„Çø„Ç§„Éó:</label>
                        <div class="radio-grid">
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="red" required>
                                <span>Ëµ§„ÉØ„Ç§„É≥</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="white">
                                <span>ÁôΩ„ÉØ„Ç§„É≥</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="rose">
                                <span>„É≠„Çº„ÉØ„Ç§„É≥</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="wineType" value="sparkling">
                                <span>„Çπ„Éë„Éº„ÇØ„É™„É≥„Ç∞</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="grapes">„Éñ„Éâ„Ç¶ÂìÅÁ®Æ:</label>
                            <input type="text" id="grapes" name="grapes" placeholder="„Ç´„Éô„É´„Éç„Éª„ÇΩ„Éº„É¥„Ç£„Éã„É®„É≥ 70%, „É°„É´„É≠„Éº 30%">
                        </div>
                        <div class="form-group">
                            <label for="alcohol">„Ç¢„É´„Ç≥„Éº„É´Â∫¶Êï∞ (%):</label>
                            <input type="number" id="alcohol" name="alcohol" min="0" max="20" step="0.1">
                        </div>
                    </div>
                </div>
                
                <!-- Â§ñË¶≥ÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="form-section">
                    <h3>Â§ñË¶≥ÂàÜÊûê</h3>
                    <div class="analysis-grid">
                        <div class="analysis-item">
                            <h4>Ëâ≤Ë™ø</h4>
                            <div class="radio-grid">
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="purple">
                                    <span>Á¥´„Åå„Åã„Å£„Åü</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="ruby">
                                    <span>„É´„Éì„ÉºËâ≤</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="garnet">
                                    <span>„Ç¨„Éº„Éç„ÉÉ„ÉàËâ≤</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorTone" value="golden">
                                    <span>ÈáëËâ≤</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="analysis-item">
                            <h4>ÊøÉÊ∑°</h4>
                            <div class="radio-grid">
                                <label class="radio-item">
                                    <input type="radio" name="colorIntensity" value="pale">
                                    <span>Ê∑°„ÅÑ</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorIntensity" value="medium">
                                    <span>‰∏≠Á®ãÂ∫¶</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="colorIntensity" value="deep">
                                    <span>ÊøÉ„ÅÑ</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="analysis-item">
                            <h4>ÈÄèÊòéÂ∫¶</h4>
                            <div class="radio-grid">
                                <label class="radio-item">
                                    <input type="radio" name="clarity" value="clear">
                                    <span>ÊæÑÊòé</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="clarity" value="hazy">
                                    <span>„ÇÑ„ÇÑÊøÅ„Çä</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="clarity" value="opaque">
                                    <span>‰∏çÈÄèÊòé</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- È¶ô„ÇäÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="form-section">
                    <h3>È¶ô„ÇäÂàÜÊûê</h3>
                    <div class="aroma-analysis">
                        <div class="aroma-category">
                            <h4>„Éï„É´„Éº„ÉÑÁ≥ª</h4>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="blackberry">
                                    <span>„Éñ„É©„ÉÉ„ÇØ„Éô„É™„Éº</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="cherry">
                                    <span>„ÉÅ„Çß„É™„Éº</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="plum">
                                    <span>„Éó„É©„É†</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="citrus">
                                    <span>ÊüëÊ©òÁ≥ª</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="aroma-category">
                            <h4>„Çπ„Éë„Ç§„ÇπÁ≥ª</h4>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="vanilla">
                                    <span>„Éê„Éã„É©</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="pepper">
                                    <span>„Ç≥„Ç∑„Éß„Ç¶</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="cinnamon">
                                    <span>„Ç∑„Éä„É¢„É≥</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="clove">
                                    <span>„ÇØ„É≠„Éº„Éñ</span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="aroma-category">
                            <h4>„Ç¢„Éº„Ç∑„ÉºÁ≥ª</h4>
                            <div class="checkbox-grid">
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="oak">
                                    <span>„Ç™„Éº„ÇØ</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="tobacco">
                                    <span>„Çø„Éê„Ç≥</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="leather">
                                    <span>Èù©</span>
                                </label>
                                <label class="checkbox-item">
                                    <input type="checkbox" name="aroma" value="earth">
                                    <span>ÂúüÁ≥ª</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Âë≥„Çè„ÅÑÂàÜÊûê„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="form-section">
                    <h3>Âë≥„Çè„ÅÑÂàÜÊûê</h3>
                    <div class="taste-analysis">
                        <div class="taste-scale">
                            <label>ÁîòÂë≥ (1-5):</label>
                            <div class="star-rating" data-rating="sweetness">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" name="sweetness" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>ÈÖ∏Âë≥ (1-5):</label>
                            <div class="star-rating" data-rating="acidity">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" name="acidity" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>„Çø„É≥„Éã„É≥ (1-5):</label>
                            <div class="star-rating" data-rating="tannin">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" name="tannin" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>„Éú„Éá„Ç£ (1-5):</label>
                            <div class="star-rating" data-rating="body">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" name="body" value="0">
                        </div>
                        
                        <div class="taste-scale">
                            <label>„Éï„Ç£„Éã„ÉÉ„Ç∑„É• (1-5):</label>
                            <div class="star-rating" data-rating="finish">
                                <span class="star" data-value="1">‚òÖ</span>
                                <span class="star" data-value="2">‚òÖ</span>
                                <span class="star" data-value="3">‚òÖ</span>
                                <span class="star" data-value="4">‚òÖ</span>
                                <span class="star" data-value="5">‚òÖ</span>
                            </div>
                            <input type="hidden" name="finish" value="0">
                        </div>
                    </div>
                </div>
                
                <!-- Á∑èÂêàË©ï‰æ°„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="form-section">
                    <h3>Á∑èÂêàË©ï‰æ°</h3>
                    <div class="overall-rating">
                        <label>Á∑èÂêàË©ï‰æ° (1-5):</label>
                        <div class="star-rating" data-rating="wineRating">
                            <span class="star" data-value="1">‚òÖ</span>
                            <span class="star" data-value="2">‚òÖ</span>
                            <span class="star" data-value="3">‚òÖ</span>
                            <span class="star" data-value="4">‚òÖ</span>
                            <span class="star" data-value="5">‚òÖ</span>
                        </div>
                        <input type="hidden" name="wineRating" value="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="notes">Ë©≥Á¥∞„É°„É¢:</label>
                        <textarea id="notes" name="notes" rows="4" placeholder="Âë≥„Çè„ÅÑ„ÄÅÂç∞Ë±°„ÄÅ„Éö„Ç¢„É™„É≥„Ç∞Êé®Â•®„Å™„Å©„ÇíË®òÈå≤"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="foodPairing">„Éï„Éº„Éâ„Éö„Ç¢„É™„É≥„Ç∞:</label>
                        <input type="text" id="foodPairing" name="foodPairing" placeholder="„Çπ„ÉÜ„Éº„Ç≠„ÄÅ„ÉÅ„Éº„Ç∫„ÄÅ„ÉÅ„Éß„Ç≥„É¨„Éº„Éà„Å™„Å©">
                    </div>
                    
                    <div class="form-group">
                        <label for="occasion">È£≤Áî®„Ç∑„Éº„É≥:</label>
                        <input type="text" id="occasion" name="occasion" placeholder="Ë™ïÁîüÊó•„ÄÅ„Éá„Ç£„Éä„Éº„ÄÅ„Éë„Éº„ÉÜ„Ç£„Éº„Å™„Å©">
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn primary-btn">Ë©≥Á¥∞Ë®òÈå≤„Çí‰øùÂ≠ò</button>
                    <button type="button" class="btn outline-btn" onclick="hideUltraAdvancedForm()">„Ç≠„É£„É≥„Çª„É´</button>
                </div>
            </form>
        </div>

        <!-- „ÉØ„Ç§„É≥‰∏ÄË¶ß -->
        <div class="wine-list" id="wineListSection" style="display: none;">
            <h2>Ë®òÈå≤„Åï„Çå„Åü„ÉØ„Ç§„É≥</h2>
            <div id="wineRecords">
                <p>„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÉØ„Ç§„É≥„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜ</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK (CDN) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut as firebaseSignOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, where, limit } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // FirebaseË®≠ÂÆö
        const firebaseConfig = {
            apiKey: "AIzaSyB6jnGUsdR9JDTZoDUq_QhM4Gr_gLVp3qA",
            authDomain: "mywinememory.firebaseapp.com",
            projectId: "mywinememory",
            storageBucket: "mywinememory.firebasestorage.app",
            messagingSenderId: "179280253269",
            appId: "1:179280253269:web:58330b5938412fafc21fdc",
            measurementId: "G-PP1B5425FD"
        };

        // FirebaseÂàùÊúüÂåñ
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentUser = null;
        let wineRecords = [];
        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let charts = {};

        // „ÇØ„Ç§„Ç∫„Éá„Éº„Çø
        const quizData = {
            basic: [
                {
                    question: "„Éï„É©„É≥„Çπ„ÅÆ‰ª£Ë°®ÁöÑ„Å™„ÉØ„Ç§„É≥Áî£Âú∞„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    options: ["„Éú„É´„Éâ„Éº", "„Éà„Çπ„Ç´„Éº„Éä", "„Éä„Éë„Éê„É¨„Éº", "„É¢„Éº„Çº„É´"],
                    correct: 0
                },
                {
                    question: "Ëµ§„ÉØ„Ç§„É≥„ÅÆ‰∏ª„Å™Ëâ≤Á¥†ÊàêÂàÜ„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                    options: ["„Çø„É≥„Éã„É≥", "„Ç¢„É≥„Éà„Ç∑„Ç¢„Éã„É≥", "„É¨„Çπ„Éô„É©„Éà„É≠„Éº„É´", "„Ç¢„É´„Ç≥„Éº„É´"],
                    correct: 1
                },
                {
                    question: "„Ç∑„É£„É≥„Éë„Éº„Éã„É•„ÅÆË£ΩÊ≥ï„Å®„Åó„Å¶Ê≠£„Åó„ÅÑ„ÅÆ„ÅØ„Å©„Çå„Åß„Åô„ÅãÔºü",
                    options: ["„Ç∑„É£„É´„ÉûÊñπÂºè", "„É°„Éà„Éº„Éâ„Éª„Ç∑„É£„É≥„Éó„Éé„ÉØ„Éº„Ç∫", "ÁÇ≠ÈÖ∏Ê≥®ÂÖ•", "Ëá™ÁÑ∂Áô∫ÈÖµ"],
                    correct: 1
                }
            ],
            advanced: [
                {
                    question: "„Éú„É´„Éâ„Éº„ÅÆÂ∑¶Â≤∏„Åß‰∏ª„Å´Ê†ΩÂüπ„Åï„Çå„Çã„Éñ„Éâ„Ç¶ÂìÅÁ®Æ„ÅØÔºü",
                    options: ["„É°„É´„É≠„Éº", "„Ç´„Éô„É´„Éç„Éª„ÇΩ„Éº„É¥„Ç£„Éã„É®„É≥", "„Éî„Éé„Éª„Éé„ÉØ„Éº„É´", "„Ç∑„É©„Éº"],
                    correct: 1
                },
                {
                    question: "„Éû„É≠„É©„ÇØ„ÉÜ„Ç£„ÉÉ„ÇØÁô∫ÈÖµ„ÅÆÁõÆÁöÑ„ÅØÔºü",
                    options: ["Á≥ñÂàÜ„Çí„Ç¢„É´„Ç≥„Éº„É´„Å´Â§âÊèõ", "ÈÖ∏Âë≥„ÇíÂíå„Çâ„Åí„Çã", "Ëâ≤Á¥†„ÇíÊäΩÂá∫", "„Çø„É≥„Éã„É≥„ÇíÈô§Âéª"],
                    correct: 1
                }
            ],
            regions: [
                {
                    question: "„Éñ„É´„Ç¥„Éº„Éã„É•„ÅÆ‰ª£Ë°®ÁöÑ„Å™ÁôΩ„Éñ„Éâ„Ç¶ÂìÅÁ®Æ„ÅØÔºü",
                    options: ["„Ç∑„É£„É´„Éâ„Éç", "„ÇΩ„Éº„É¥„Ç£„Éã„É®„É≥„Éª„Éñ„É©„É≥", "„É™„Éº„Çπ„É™„É≥„Ç∞", "„Ç≤„É¥„É•„É´„ÉÑ„Éà„É©„Éü„Éä„Éº"],
                    correct: 0
                },
                {
                    question: "„Ç≠„É£„É≥„ÉÜ„Ç£„ÅØ„Å©„ÅÆÂõΩ„ÅÆ„ÉØ„Ç§„É≥„Åß„Åô„ÅãÔºü",
                    options: ["„Éï„É©„É≥„Çπ", "„Ç§„Çø„É™„Ç¢", "„Çπ„Éö„Ç§„É≥", "„Éâ„Ç§„ÉÑ"],
                    correct: 1
                }
            ],
            tasting: [
                {
                    question: "„ÉØ„Ç§„É≥„ÅÆ„Äå„Éú„Éá„Ç£„Äç„Å®„ÅØ‰Ωï„ÇíË°®„Åó„Åæ„Åô„ÅãÔºü",
                    options: ["Ëâ≤„ÅÆÊøÉ„Åï", "È¶ô„Çä„ÅÆÂº∑„Åï", "Âë≥„Çè„ÅÑ„ÅÆÂéö„Åø", "„Ç¢„É´„Ç≥„Éº„É´Â∫¶Êï∞"],
                    correct: 2
                },
                {
                    question: "„Çø„É≥„Éã„É≥„ÅåÂ§ö„ÅÑ„ÉØ„Ç§„É≥„ÅÆÁâπÂæ¥„ÅØÔºü",
                    options: ["Áîò„ÅÑ", "Ê∏ã„ÅÑ", "ÈÖ∏„Å£„Å±„ÅÑ", "Â°©Ëæõ„ÅÑ"],
                    correct: 1
                }
            ]
        };

        // „É≠„Éº„Éá„Ç£„É≥„Ç∞ÁîªÈù¢„ÅÆÂà∂Âæ°
        function showLoadingOverlay(show, message = '') {
            const overlay = document.getElementById('loadingOverlay');
            if (show) {
                overlay.style.display = 'flex';
                if (message) {
                    const subtext = overlay.querySelector('.loading-subtext');
                    subtext.textContent = message;
                }
            } else {
                overlay.style.display = 'none';
            }
        }

        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üç∑ MyWineMemory - Ultra AdvancedÁâà„ÇíÂàùÊúüÂåñ‰∏≠...');
            
            showLoadingOverlay(true, '„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÇíÊ∫ñÂÇô‰∏≠...');
            
            // ÊúÄ‰Ωé3ÁßíÈñì„ÅØ„É≠„Éº„Éá„Ç£„É≥„Ç∞„ÇíË°®Á§∫
            setTimeout(() => {
                showLoadingOverlay(false);
            }, 3000);

            initTheme();
            initMobileMenu();
            initStarRatings();
        });

        // Ë™çË®ºÁä∂ÊÖã„ÅÆÁõ£Ë¶ñ
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateUI();
            if (user) {
                loadWineRecords();
                updateStats();
            }
        });

        // UIÊõ¥Êñ∞
        function updateUI() {
            const loginView = document.getElementById('loginView');
            const userView = document.getElementById('userView');
            const userName = document.getElementById('userName');

            if (currentUser) {
                loginView.classList.add('hidden');
                userView.classList.remove('hidden');
                userName.textContent = currentUser.displayName || currentUser.email;
            } else {
                loginView.classList.remove('hidden');
                userView.classList.add('hidden');
            }
        }

        // Google„É≠„Ç∞„Ç§„É≥
        window.signInWithGoogle = async function() {
            console.log('üîê Google login attempt started');
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                console.log('‚úÖ Google login successful');
                showStatus('„É≠„Ç∞„Ç§„É≥„Å´ÊàêÂäü„Åó„Åæ„Åó„Åü', 'success');
            } catch (error) {
                console.error('‚ùå Google login failed:', error);
                showStatus('„É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            }
        }

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        window.signOut = async function() {
            try {
                await firebaseSignOut(auth);
                showStatus('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü', 'success');
                document.getElementById('wineRecords').innerHTML = '<p>„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÉØ„Ç§„É≥„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜ</p>';
                wineRecords = [];
                updateStats();
            } catch (error) {
                showStatus('„É≠„Ç∞„Ç¢„Ç¶„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥Ë°®Á§∫Âàá„ÇäÊõø„Åà
        window.showSection = function(sectionName) {
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.remove('active'));
            
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // „Ç¢„Éä„É™„ÉÜ„Ç£„ÇØ„Çπ„Çª„ÇØ„Ç∑„Éß„É≥„ÅÆÂ†¥Âêà„ÄÅ„ÉÅ„É£„Éº„Éà„ÇíÂàùÊúüÂåñ
            if (sectionName === 'analytics') {
                initAnalytics();
            }
        }

        // Ë∂ÖË©≥Á¥∞„Éï„Ç©„Éº„É†Ë°®Á§∫
        window.showUltraAdvancedForm = function() {
            if (!currentUser) {
                showStatus('„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô', 'error');
                return;
            }
            document.getElementById('ultraAdvancedForm').style.display = 'block';
        }

        // Ë∂ÖË©≥Á¥∞„Éï„Ç©„Éº„É†ÈùûË°®Á§∫
        window.hideUltraAdvancedForm = function() {
            document.getElementById('ultraAdvancedForm').style.display = 'none';
            document.getElementById('ultraWineForm').reset();
            resetStarRatings();
        }

        // Ë∂ÖË©≥Á¥∞„ÉØ„Ç§„É≥Ë®òÈå≤‰øùÂ≠ò
        window.saveUltraWineRecord = async function(event) {
            event.preventDefault();
            
            if (!currentUser) {
                showStatus('„É≠„Ç∞„Ç§„É≥„ÅåÂøÖË¶Å„Åß„Åô', 'error');
                return;
            }

            const formData = new FormData(event.target);
            const wineData = {
                wineName: formData.get('wineName'),
                producer: formData.get('producer'),
                region: formData.get('region'),
                vintage: parseInt(formData.get('vintage')) || null,
                price: parseInt(formData.get('price')) || null,
                purchaseDate: formData.get('purchaseDate'),
                wineType: formData.get('wineType'),
                grapes: formData.get('grapes'),
                alcohol: parseFloat(formData.get('alcohol')) || null,
                colorTone: formData.get('colorTone'),
                colorIntensity: formData.get('colorIntensity'),
                clarity: formData.get('clarity'),
                aroma: formData.getAll('aroma'),
                sweetness: parseInt(formData.get('sweetness')),
                acidity: parseInt(formData.get('acidity')),
                tannin: parseInt(formData.get('tannin')),
                body: parseInt(formData.get('body')),
                finish: parseInt(formData.get('finish')),
                wineRating: parseInt(formData.get('wineRating')),
                notes: formData.get('notes'),
                foodPairing: formData.get('foodPairing'),
                occasion: formData.get('occasion'),
                userId: currentUser.uid,
                createdAt: new Date()
            };

            try {
                await addDoc(collection(db, 'wine_records'), wineData);
                showStatus('Ë©≥Á¥∞„ÉØ„Ç§„É≥Ë®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
                hideUltraAdvancedForm();
                loadWineRecords();
                updateStats();
            } catch (error) {
                showStatus('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            }
        }

        // „ÉØ„Ç§„É≥Ë®òÈå≤Ë™≠„ÅøËæº„Åø
        async function loadWineRecords() {
            if (!currentUser) return;

            try {
                const q = query(
                    collection(db, 'wine_records'),
                    where('userId', '==', currentUser.uid),
                    orderBy('createdAt', 'desc'),
                    limit(6)
                );
                
                const querySnapshot = await getDocs(q);
                const recentWinesContainer = document.getElementById('recentWines');
                
                if (querySnapshot.empty) {
                    recentWinesContainer.innerHTML = '<p class="empty-state">„Åæ„Å†„ÉØ„Ç§„É≥„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÊúÄÂàù„ÅÆ„ÉØ„Ç§„É≥„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜÔºÅ</p>';
                    return;
                }

                let html = '';
                wineRecords = [];
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    wineRecords.push(data);
                    html += `
                        <div class="wine-card">
                            <h3>${data.wineName}</h3>
                            <p class="producer">${data.producer}</p>
                            ${data.region ? `<p class="region">${data.region}</p>` : ''}
                            <div class="rating">${'‚≠ê'.repeat(data.wineRating || 0)}</div>
                            ${data.notes ? `<p class="notes">${data.notes.substring(0, 100)}...</p>` : ''}
                        </div>
                    `;
                });
                
                recentWinesContainer.innerHTML = html;
            } catch (error) {
                showStatus('„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            }
        }

        // Áµ±Ë®àÊÉÖÂ†±Êõ¥Êñ∞
        function updateStats() {
            const totalWinesEl = document.getElementById('totalWines');
            const avgRatingEl = document.getElementById('avgRating');
            
            if (wineRecords.length > 0) {
                totalWinesEl.textContent = wineRecords.length;
                const avgRating = wineRecords.reduce((sum, wine) => sum + (wine.wineRating || 0), 0) / wineRecords.length;
                avgRatingEl.textContent = avgRating.toFixed(1);
            } else {
                totalWinesEl.textContent = '0';
                avgRatingEl.textContent = '0.0';
            }
        }

        // „ÇØ„Ç§„Ç∫Ê©üËÉΩ
        window.startQuiz = function(type) {
            currentQuiz = quizData[type];
            currentQuestionIndex = 0;
            score = 0;
            
            document.querySelector('.quiz-types').style.display = 'none';
            document.getElementById('quizGame').classList.remove('hidden');
            
            showQuestion();
        }

        function showQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('questionOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'quiz-option';
                button.textContent = option;
                button.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(button);
            });
            
            updateProgress();
            document.getElementById('nextButton').disabled = true;
        }

        function selectAnswer(selectedIndex) {
            const question = currentQuiz[currentQuestionIndex];
            const options = document.querySelectorAll('.quiz-option');
            
            options.forEach((option, index) => {
                option.disabled = true;
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === question.correct) {
                score++;
            }
            
            document.getElementById('nextButton').disabled = false;
        }

        window.nextQuestion = function() {
            currentQuestionIndex++;
            
            if (currentQuestionIndex >= currentQuiz.length) {
                showQuizResults();
            } else {
                showQuestion();
            }
        }

        function showQuizResults() {
            document.getElementById('quizGame').classList.add('hidden');
            const resultsContainer = document.getElementById('quizResults');
            resultsContainer.classList.remove('hidden');
            
            document.getElementById('finalScore').textContent = score;
            
            let message = '';
            const percentage = (score / currentQuiz.length) * 100;
            if (percentage >= 80) {
                message = '„Åô„Å∞„Çâ„Åó„ÅÑÔºÅ„ÉØ„Ç§„É≥„Ç®„Ç≠„Çπ„Éë„Éº„Éà„Åß„Åô„Å≠ÔºÅ';
            } else if (percentage >= 60) {
                message = '„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ„ÇÇ„ÅÜÂ∞ë„Åó„ÅßÂÆåÁíß„Åß„Åô„ÄÇ';
            } else {
                message = 'È†ëÂºµ„Çä„Åæ„Åó„ÅüÔºÅ„Åï„Çâ„Å´Â≠¶Áøí„ÇíÁ∂ö„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ';
            }
            
            document.getElementById('resultMessage').textContent = message;
        }

        window.restartQuiz = function() {
            document.getElementById('quizResults').classList.add('hidden');
            document.querySelector('.quiz-types').style.display = 'grid';
        }

        window.endQuiz = function() {
            document.getElementById('quizGame').classList.add('hidden');
            document.querySelector('.quiz-types').style.display = 'grid';
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentQuiz.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${currentQuestionIndex + 1}/${currentQuiz.length}`;
        }

        // „Ç¢„Éä„É™„ÉÜ„Ç£„ÇØ„ÇπÂàùÊúüÂåñ
        function initAnalytics() {
            if (wineRecords.length === 0) return;

            // Ë©ï‰æ°ÂàÜÂ∏É„ÉÅ„É£„Éº„Éà
            if (charts.ratingChart) charts.ratingChart.destroy();
            const ratingCtx = document.getElementById('ratingChart').getContext('2d');
            const ratingData = [1, 2, 3, 4, 5].map(rating => 
                wineRecords.filter(wine => wine.wineRating === rating).length
            );
            
            charts.ratingChart = new Chart(ratingCtx, {
                type: 'bar',
                data: {
                    labels: ['1‚≠ê', '2‚≠ê', '3‚≠ê', '4‚≠ê', '5‚≠ê'],
                    datasets: [{
                        label: 'Ë®òÈå≤Êï∞',
                        data: ratingData,
                        backgroundColor: 'rgba(102, 126, 234, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            // „ÉØ„Ç§„É≥„Çø„Ç§„ÉóÂà•„ÉÅ„É£„Éº„Éà
            if (charts.typeChart) charts.typeChart.destroy();
            const typeCtx = document.getElementById('typeChart').getContext('2d');
            const types = ['red', 'white', 'rose', 'sparkling'];
            const typeData = types.map(type => 
                wineRecords.filter(wine => wine.wineType === type).length
            );
            
            charts.typeChart = new Chart(typeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Ëµ§„ÉØ„Ç§„É≥', 'ÁôΩ„ÉØ„Ç§„É≥', '„É≠„Çº', '„Çπ„Éë„Éº„ÇØ„É™„É≥„Ç∞'],
                    datasets: [{
                        data: typeData,
                        backgroundColor: ['#dc2626', '#fbbf24', '#f472b6', '#60a5fa']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // „Çπ„Çø„ÉºË©ï‰æ°„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
        function initStarRatings() {
            const starRatings = document.querySelectorAll('.star-rating');
            
            starRatings.forEach(rating => {
                const stars = rating.querySelectorAll('.star');
                const ratingName = rating.getAttribute('data-rating');
                const hiddenInput = document.querySelector(`input[name="${ratingName}"]`);
                
                stars.forEach(star => {
                    star.addEventListener('click', function() {
                        const value = this.getAttribute('data-value');
                        hiddenInput.value = value;
                        
                        stars.forEach((s, index) => {
                            if (index < value) {
                                s.classList.add('active');
                            } else {
                                s.classList.remove('active');
                            }
                        });
                    });
                });
            });
        }

        function resetStarRatings() {
            const stars = document.querySelectorAll('.star');
            const hiddenInputs = document.querySelectorAll('.star-rating + input[type="hidden"]');
            
            stars.forEach(star => star.classList.remove('active'));
            hiddenInputs.forEach(input => input.value = '0');
        }

        // „ÉÜ„Éº„ÉûÂàá„ÇäÊõø„ÅàÊ©üËÉΩ
        function initTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.querySelector('.theme-icon');
            
            const savedTheme = localStorage.getItem('theme') || 
                (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            
            setTheme(savedTheme);
            
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });
            
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                themeIcon.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            }
        }

        // „É¢„Éê„Ç§„É´„É°„Éã„É•„ÉºÂà∂Âæ°
        function initMobileMenu() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const navbarMenu = document.getElementById('navbarMenu');
            
            if (mobileMenuToggle && navbarMenu) {
                mobileMenuToggle.addEventListener('click', () => {
                    mobileMenuToggle.classList.toggle('active');
                    navbarMenu.classList.toggle('active');
                });
                
                const navLinks = navbarMenu.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenuToggle.classList.remove('active');
                        navbarMenu.classList.remove('active');
                    });
                });
                
                document.addEventListener('click', (e) => {
                    if (!mobileMenuToggle.contains(e.target) && !navbarMenu.contains(e.target)) {
                        mobileMenuToggle.classList.remove('active');
                        navbarMenu.classList.remove('active');
                    }
                });
            }
        }

        // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function showStatus(message, type) {
            const statusEl = document.getElementById('authStatus');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
            
            setTimeout(() => {
                statusEl.classList.add('hidden');
            }, 3000);
        }

        console.log('üç∑ MyWineMemory Ultra Advanced initialized successfully');
    </script>

    <!-- Service WorkerÁôªÈå≤ -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then((registration) => {
                    console.log('Service Worker registered');
                    
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                showUpdateAvailable();
                            }
                        });
                    });
                })
                .catch(err => console.log('Service Worker registration failed:', err));
        }

        function showUpdateAvailable() {
            const updateBanner = document.createElement('div');
            updateBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: #4CAF50;
                color: white;
                padding: 10px;
                text-align: center;
                z-index: 10000;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            `;
            updateBanner.innerHTML = `
                Êñ∞„Åó„ÅÑ„Éê„Éº„Ç∏„Éß„É≥„ÅåÂà©Áî®ÂèØËÉΩ„Åß„ÅôÔºÅ
                <button onclick="updateApp()" style="margin-left: 10px; padding: 5px 10px; background: white; color: #4CAF50; border: none; border-radius: 3px; cursor: pointer;">
                    Êõ¥Êñ∞
                </button>
                <button onclick="this.parentElement.remove()" style="margin-left: 5px; padding: 5px 10px; background: transparent; color: white; border: 1px solid white; border-radius: 3px; cursor: pointer;">
                    Âæå„Åß
                </button>
            `;
            document.body.appendChild(updateBanner);
        }

        window.updateApp = function() {
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ action: 'skipWaiting' });
            }
            window.location.reload();
        }
    </script>
</body>
</html>